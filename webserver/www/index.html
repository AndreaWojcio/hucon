<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="de">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="cache-control" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=0.8">
    <title>HuCon Robot :)</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="semantic/semantic.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="jquery/jquery-3.3.1.min.js"></script>
    <script src="semantic/semantic.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $.ajax('/get_version', {
                method: 'POST',
                success: function(message) {
                    var data = JSON.parse(message);
                    $('#version').html(data['version']);
                },
                error: appendErrorLog
            });
        }());

        $(document).ready(function poll() {
            $.ajax('/poll', {
                method: 'POST',
                timeout: 30000, // 30 seconds
                success: function(message){
                    appendConsoleLog(message);
                    poll();
                },
                error: function(){
                    setTimeout(poll, 1000);
                }
            });
        }());

        function shutdownSystem() {
            $('#shutdownModal').modal('show');
            $('#consoleLog').html('');

            $.ajax('/shutdown', {
                method: 'POST',
                error: appendErrorLog
            });
        }

        function appendConsoleLog(message) {
            $('#consoleLog').append(message.replace(/\n/g, '<br>'));
            $("#consoleLog").scrollTop($("#consoleLog")[0].scrollHeight);
        }

        function appendErrorLog(request, status, error) {
            appendConsoleLog(error + ' : ' + request.responseText + '\n');
        }
    </script>

<head>
</head>
<body>

    <div class="container">

        <div id="headerArea">
            <button onclick="window.open('https://github.com/juwis/hackerschool')" class="circular ui icon button" style="position: relative;">
                <i class="icon github"></i>
                <div class="floating ui blue label" id="version">error</div>
                GitHub
            </button>

            <button onclick="shutdownSystem()" class="circular ui icon button"style="top: 8px; right: 8px; position: absolute;">
                <i class="icon power off"></i>
            </button>
        </div>

        <div class="center">
            <button onclick="location.href='blockly.html'" class="fluid ui orange button">Blockly</button><br>
            <button onclick="location.href='editor.html'" class="fluid ui orange button">Editor</button><br>
            <button onclick="location.href='remote_control.html'" class="fluid ui orange button">Remote Control</button><br>
            <p class="whitesmoke">The following site is good when<br>
            the device has no internet con-<br>
            nection.</p>
            <button onclick="location.href='mobile.html'" class="fluid ui blue button">Mobile</button><br>
            <p class="whitesmoke">You can change your password<br>
            or update the system<br>
            with the following site.</p>
            <button onclick="location.href='settings.html'" class="fluid ui light_blue button">Settings</button><br>
            </div>
        </div>

    </div>

    <div id="shutdownModal" class="ui modal">
        <div class="header">Shutdown</div>
        <div class="content">
            <div id="consoleLog" class="codeText" style="height: 300px; overflow-y: scroll;"></div>
            <button onclick="$('#shutdownModal').modal('hide')" class="ui orange button">Close</button>
        </div>
    </div>

</body>
</html>
