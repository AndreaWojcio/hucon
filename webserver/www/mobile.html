<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="de">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="cache-control" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HuCon Robot :) - Mobile</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="semantic/semantic.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="jquery/jquery-3.3.1.min.js"></script>
    <script src="semantic/semantic.min.js"></script>

    <script type="text/javascript" src="js/webserver.js"></script>

    <script type="text/javascript">

        // On document ready this function will be called and initialize the complete website.
        $(document).ready(function () {

            // Load the extra template content
            $('#menuArea').load('template/menu.html', configureMenu);
            $('#logArea').load('template/console.html');
            $('#buttonModal').load('template/button.html');

            $.ajax('/get_file_list', {
                method: 'POST',
                dataType: 'json',
                success: function(data) {
                    var values = Array();
                    var isFirst = true;

                    for (i=0; i<data['files'].length; i++) {
                        var filename = data['files'][i]
                        if (filename.substr(-3) === '.py') {
                            values.push({name: filename.slice(0, -3), value: filename, selected: isFirst});
                            isFirst = false;
                        }
                    }

                    $('#fileDropDown').dropdown({
                        values: values
                    });
                },
                error: appendErrorLog
            });

            // poll for new messages
            poll();
        });


        // Hide the code button from the menu.
        function configureMenu() {
            $('#fileButton').hide();
            $('#codeButton').hide();
            $('#consoleButton').hide();
        }

        // Overwrite the run function to run the application from the device.
        function run() {
            $('#consoleLog').html('');
            appendConsoleLog('Loading program ...', 'green');

            var data = {};
            data['filename'] = document.getElementById('filename').value;
            $.ajax('/run', {
                method: 'POST',
                data: JSON.stringify(data),
                success: appendConsoleLog,
                error: appendErrorLog
            });

            $('#runButton').addClass('disabled')
            $('#stopButton').removeClass('disabled')
            setTimeout(isRunning, 1000 );
        }

    </script>
<head>
</head>
<body>

    <div class="container">
        <div id="menuArea" class="ui top attached menu"></div>
        <div id="logArea" class="ui bottom attached" style="height: calc(100% - 40px);;"></div>
    </div>

    <div id="buttonModal" class="ui modal"></div>

</body>
</html>