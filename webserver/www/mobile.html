<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="de">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="cache-control" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacker School :) - Mobile</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css">

    <!-- Hacker School web server -->
    <script type="text/javascript" src="docReady/docready.js"></script>
    <script type="text/javascript" src="js/webserver_functions.js"></script>

    <script type="text/javascript">
        docReady(function(){
            ajax('POST', 'get_version', '', function(message) {
                var data = JSON.parse(message);
                console.log(data['version'])
                document.getElementById('version').innerHTML = data['version'];
            });

            document.getElementById('fileText').hidden = true
            ajax('POST', 'get_file_list', '', function(message) {
                selection = document.getElementById('fileSelect');
                for(i = selection.options.length - 1 ; i >= 0 ; i--) {
                    selection.remove(i);
                }

                var data = JSON.parse(message);
                var extension = '.py';

                for (i=0; i<data['files'].length; i++) {
                    var filename = data['files'][i];
                    if (filename.endsWith(extension)) {
                        var opt = document.createElement('option');
                        opt.text = filename.slice(0, -extension.length);
                        opt.value = filename.slice(0, -extension.length);
                        selection.options.add(opt);
                    }
                }

                document.getElementById('fileText').value = selection.options[selection.selectedIndex].value;
            });
        });
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript">
        (function poll() {
            $.ajax('/poll', {
                method: 'POST',
                timeout: 30000, // 30 seconds
                success: function(message){
                    document.getElementById('consoleLog').value += message + '\n';
                    poll();
                },
                error: function(){
                    setTimeout(poll, 1000);
                },
                data: ''
            });
        }());
    </script>

<head>
</head>
<body id="body">
    <table>
        <tr>
            <td id="header" colspan="2"><div id="version"></div></td>
        </tr>
        <tr>
            <td colspan="2" id="commands">
                <button onclick="location.href='index.html'" class="button blue">Index</button>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                Execute Script
            </td>
        </tr>
        <tr>
            <td>
                <div class="select-editable">
                    <select id="fileSelect" onchange="this.nextElementSibling.value=this.value"></select>
                    <input id="fileText" type="text" name="format" value=""/>
                </div>
            </td>
            <td style="width: 100px;">
                <button onclick="command('run')" class="button orange" style="height: 43px;">Run</button>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                Console Log:
            </td>
        </tr>
        <tr style="height: 100%">
            <td colspan="2">
                <textarea class="text" style="height: 100%" id="consoleLog"></textarea>
            </td>
        </tr>
    </table>
</body>
</html>