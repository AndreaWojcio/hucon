function openFileDialog(load,extension){var parameter={};parameter.load=load,parameter.extension=extension,console.log("currentFile: "+currentFile);var title="",buttonText="";load?(title="Load file",buttonText="Load"):(title="Save file",buttonText="Save"),document.getElementById("fileText").hidden=load,document.getElementById("fileOkButton").value=JSON.stringify(parameter),document.getElementById("fileDialogTitle").innerHTML=title,document.getElementById("fileOkButton").innerHTML=buttonText,fileDialog=document.getElementById("fileDialog"),fileDialog.style.display="block";var data={};data.command="get_file_list",ajax("POST","__COMMAND__",JSON.stringify(data),function(message){for(selection=document.getElementById("fileSelect"),i=selection.options.length-1;i>=0;i--)selection.remove(i);var data=JSON.parse(message);load||((opt=document.createElement("option")).text="",opt.value="",selection.options.add(opt));var selectedIndex=0;for(i=0;i<data.files.length;i++){var filename=data.files[i];if(filename.endsWith(extension)){var opt=document.createElement("option"),value=filename.slice(0,-extension.length);opt.text=value,opt.value=value,selection.options.add(opt),value==currentFile&&(selectedIndex=selection.options.length-1)}}selection.options[selectedIndex].selected=!0,document.getElementById("fileText").value=selection.options[selection.selectedIndex].value})}function fileDialogOk(){var callback,parameter=JSON.parse(document.getElementById("fileOkButton").value),filename=document.getElementById("fileText").value,command="",data="";if(/^[A-Za-z0-9_]+$/.test(filename)){currentFile=filename,parameter.load?(command="load",callback=function(message){var fileData=message;".py"==parameter.extension&&(fileData=fileData.replace(/HSTerm.term_exec/g,"print")),loadFile(fileData)}):(command="save",data=getFileData(),".py"==parameter.extension&&(data=data.replace(/print/g,"HSTerm.term_exec")),callback=apendConsoleLog),closeFileDialog();var url="__FILE_ACCESS__?command="+command+"&filename="+filename+parameter.extension;ajax("POST",url,data,callback),parameter.load||".py"==parameter.extension||ajax("POST",url="__FILE_ACCESS__?command="+command+"&filename="+filename+".py",getPythonCode().replace(/print/g,"HSTerm.term_exec"),callback)}else alert("You have to enter a valid filename.\nOnly characters from a-z, numbers and _ are allowed.")}function closeFileDialog(){fileialog=document.getElementById("fileDialog"),fileDialog.style.display="none"}function apendConsoleLog(message){var time=(new Date).toLocaleTimeString().replace("/.*(d{2}:d{2}:d{2}).*/","$1"),log=document.getElementById("consoleLog").value;document.getElementById("consoleLog").value=time+"\n"+message+"\n"+log;try{openConsoleLogDialog()}catch(err){}}function openConsoleLogDialog(){consoleLogDialog=document.getElementById("consoleLogDialog"),consoleLogDialog.style.display="block"}function closeConsoleLogDialog(){consoleLogDialog=document.getElementById("consoleLogDialog"),consoleLogDialog.style.display="none"}function command(value){if("set_wifi"==value)(data={}).command=value,data.apName=document.getElementById("wifiText").value,data.password=document.getElementById("password").value,ajax("POST","__COMMAND__",JSON.stringify(data),apendConsoleLog);else if("execute"==value){ajax("POST","__FILE_ACCESS__?command=execute",getPythonCode().replace(/print/g,"HSTerm.term_exec"),apendConsoleLog)}else if("save_password"==value){if(oldUsername=document.getElementById("current_username").value,oldPassword=document.getElementById("current_password").value,newUsername=document.getElementById("new_username").value,newPassword=document.getElementById("new_password").value,confirmPassword=document.getElementById("confirm_password").value,""==oldUsername||""==oldPassword||""==newUsername||""==newPassword||""==confirmPassword)return void apendConsoleLog("You must fill every element.");if(newPassword!=confirmPassword)return void apendConsoleLog("The new and confirmed password are not the same.");oldKey=btoa(oldUsername+":"+oldPassword),newKey=btoa(newUsername+":"+newPassword),(data={}).command=value,data.oldKey=oldKey,data.newKey=newKey,ajax("POST","__COMMAND__",JSON.stringify(data),apendConsoleLog)}else if("run"==value){var data={};data.command="run",data.filename=document.getElementById("fileText").value+".py",ajax("POST","__COMMAND__",JSON.stringify(data),apendConsoleLog)}}function ajax(type,url,data,callback){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){4==this.readyState&&(200==this.status?callback(this.responseText):500==this.status?apendConsoleLog(this.responseText):alert("Could not get any access on the server."))},xhttp.open(type,url,!1),xhttp.send(data)}!function(funcName,baseObj){"use strict";function ready(){if(!readyFired){readyFired=!0;for(var i=0;i<readyList.length;i++)readyList[i].fn.call(window,readyList[i].ctx);readyList=[]}}function readyStateChange(){"complete"===document.readyState&&ready()}funcName=funcName||"docReady";var readyList=[],readyFired=!1,readyEventHandlersInstalled=!1;(baseObj=baseObj||window)[funcName]=function(callback,context){if("function"!=typeof callback)throw new TypeError("callback for docReady(fn) must be a function");readyFired?setTimeout(function(){callback(context)},1):(readyList.push({fn:callback,ctx:context}),"complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(ready,1):readyEventHandlersInstalled||(document.addEventListener?(document.addEventListener("DOMContentLoaded",ready,!1),window.addEventListener("load",ready,!1)):(document.attachEvent("onreadystatechange",readyStateChange),window.attachEvent("onload",ready)),readyEventHandlersInstalled=!0))}}("docReady",window);var currentFile="";window.onclick=function(event){fileDialog=document.getElementById("fileDialog"),event.target==fileDialog&&closeFileDialog(),consoleLogDialog=document.getElementById("consoleLogDialog"),event.target==consoleLogDialog&&closeConsoleLogDialog()};