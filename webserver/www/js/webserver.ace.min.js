function newFile(){editor.setValue("# Write down your code ...\n")}function loadFile(data){data&&editor.setValue(data),apendConsoleLog("Python code loaded.")}function getPythonCode(){return editor.getValue()}function getFileData(){return editor.getValue()}function openFileDialog(load,extension){document.getElementById("fileText").hidden=load,document.getElementById("fileOkButton").value=load,load?(document.getElementById("fileDialogTitle").innerHTML="Load File",document.getElementById("fileOkButton").innerHTML="Load"):(document.getElementById("fileDialogTitle").innerHTML="Save File",document.getElementById("fileOkButton").innerHTML="Save"),fileDialog=document.getElementById("fileDialog"),fileDialog.style.display="block";var data={};data.command="get_file_list",ajax("POST","__COMMAND__",JSON.stringify(data),function(message){for(console.log(message),selection=document.getElementById("fileSelect"),i=selection.options.length-1;i>=0;i--)selection.remove(i);var data=JSON.parse(message);for(i=0;i<data.files.length;i++){var filename=data.files[i];if(filename.endsWith(extension)){var opt=document.createElement("option");opt.text=filename,opt.value=filename,selection.options.add(opt)}}document.getElementById("fileText").value=selection.options[selection.selectedIndex].value})}function fileOkClicked(){if(JSON.parse(document.getElementById("fileOkButton").value)){var data={};if(data.command="get_file_data",data.filename=document.getElementById("fileText").value,""==data.filename)return void alert("Please select a file to load.");closeFileDialog(),ajax("POST",url="__FILE_ACCESS__?command=load&filename="+data.filename,"",function(message){loadFile(message)})}else{var filename=document.getElementById("fileText").value;if(""==filename)return void alert("Write a name for the file to save.");closeFileDialog();var url="__FILE_ACCESS__?command=save&filename="+filename;ajax("POST",url,getFileData(),function(message){apendConsoleLog(message)})}}function closeFileDialog(){fileialog=document.getElementById("fileDialog"),fileDialog.style.display="none"}function openConsoleLogDialog(){consoleLogDialog=document.getElementById("consoleLogDialog"),consoleLogDialog.style.display="block"}function closeConsoleLogDialog(){consoleLogDialog=document.getElementById("consoleLogDialog"),consoleLogDialog.style.display="none"}function command(value){if("execute"==value){ajax("POST","__FILE_ACCESS__?command=execute",getPythonCode().replace(/print/g,"HSTerm.term_exec"),function(message){apendConsoleLog(message)})}else if("save_password"==value){if(oldUsername=document.getElementById("current_username").value,oldPassword=document.getElementById("current_password").value,newUsername=document.getElementById("new_username").value,newPassword=document.getElementById("new_password").value,confirmPassword=document.getElementById("confirm_password").value,""==oldUsername||""==oldPassword||""==newUsername||""==newPassword||""==confirmPassword)return void apendConsoleLog("You must fill every element.");if(newPassword!=confirmPassword)return void apendConsoleLog("The new and confirmed password are not the same.");oldKey=btoa(oldUsername+":"+oldPassword),newKey=btoa(newUsername+":"+newPassword);var data={};data.command=value,data.oldKey=oldKey,data.newKey=newKey,ajax("POST","__COMMAND__",JSON.stringify(data),function(message){apendConsoleLog(message)})}}function apendConsoleLog(message){var time=(new Date).toLocaleTimeString().replace("/.*(d{2}:d{2}:d{2}).*/","$1");document.getElementById("consoleLog").value=time+"\n\n"+message,openConsoleLogDialog()}function ajax(type,url,data,callback){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){4==this.readyState&&(200==this.status?callback(this.responseText):500==this.status?apendConsoleLog(this.responseText):alert("Could not get any access on the server."))},xhttp.open(type,url,!1),xhttp.send(data)}!function(funcName,baseObj){"use strict";function ready(){if(!readyFired){readyFired=!0;for(var i=0;i<readyList.length;i++)readyList[i].fn.call(window,readyList[i].ctx);readyList=[]}}function readyStateChange(){"complete"===document.readyState&&ready()}funcName=funcName||"docReady";var readyList=[],readyFired=!1,readyEventHandlersInstalled=!1;(baseObj=baseObj||window)[funcName]=function(callback,context){if("function"!=typeof callback)throw new TypeError("callback for docReady(fn) must be a function");readyFired?setTimeout(function(){callback(context)},1):(readyList.push({fn:callback,ctx:context}),"complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(ready,1):readyEventHandlersInstalled||(document.addEventListener?(document.addEventListener("DOMContentLoaded",ready,!1),window.addEventListener("load",ready,!1)):(document.attachEvent("onreadystatechange",readyStateChange),window.attachEvent("onload",ready)),readyEventHandlersInstalled=!0))}}("docReady",window);var editor;docReady(function(){(editor=ace.edit("editor")).setTheme("ace/theme/tomorrow_night"),editor.session.setMode("ace/mode/python")}),window.onclick=function(event){fileDialog=document.getElementById("fileDialog"),event.target==fileDialog&&closeFileDialog(),consoleLogDialog=document.getElementById("consoleLogDialog"),event.target==consoleLogDialog&&closeConsoleLogDialog()};